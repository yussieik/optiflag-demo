<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptiFlag - Advanced Trading Pattern Recognition System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
    <script>
    // Optimization simulation logic
    window.onload = function() {
        const experiments = [{ticker: 'TSLA',name: 'bayes_iter_49',score: 54.55,winRate: 54.5,rank: 1},{ticker: 'TSLA',name: 'bayes_iter_50',score: 54.55,winRate: 54.5,rank: 2},{ticker: 'TSLA',name: 'bayes_iter_33',score: 45.83,winRate: 45.8,rank: 3},{ticker: 'TSLA',name: 'bayes_iter_40',score: 45.83,winRate: 45.8,rank: 4},{ticker: 'TSLA',name: 'bayes_iter_45',score: 45.83,winRate: 45.8,rank: 5}];
        
        const steps = [
            { text: "Initializing Bayesian Optimizer...", progress: 10 },
            { text: "Loading market data...", progress: 20 },
            { text: "Detecting flagpole patterns...", progress: 35 },
            { text: "Running optimization generation 1...", progress: 45, showExperiment: 0 },
            { text: "Evaluating fitness scores...", progress: 55, showExperiment: 1 },
            { text: "Running optimization generation 5...", progress: 65, showExperiment: 2 },
            { text: "Convergence detected...", progress: 80, showExperiment: 3 },
            { text: "Validating on forward test data...", progress: 90, showExperiment: 4 },
            { text: "Optimization complete!", progress: 100 }
        ];
        
        let currentStep = 0;
        const statusText = document.getElementById('status-text');
        const progressBar = document.getElementById('progress-fill');
        const metricsContainer = document.getElementById('metrics-container');
        const patternViz = document.getElementById('pattern-viz');
        const experimentList = document.getElementById('experiment-list');
        const experimentsDiscovered = document.getElementById('experiments-discovered');
        
        // Generate random pattern visualization with animation delay
        function generatePatternBars() {
            const bars = [];
            for (let i = 0; i < 50; i++) {
                const height = Math.random() * 80 + 20;
                const isHighlight = Math.random() > 0.85;
                const delay = i * 20; // Stagger animations
                bars.push(`<div class="pattern-bar ${isHighlight ? 'highlight' : ''}" style="height: ${height}%; animation-delay: ${delay}ms"></div>`);
            }
            return bars.join('');
        }
        
        patternViz.innerHTML = generatePatternBars();
        
        // Add particle effects
        function createParticles() {
            const container = document.getElementById('intro-container');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particle.style.animationDuration = (5 + Math.random() * 5) + 's';
                container.appendChild(particle);
            }
        }
        createParticles();
        
        // Animate optimization process
        function animateStep() {
            if (currentStep < steps.length) {
                const step = steps[currentStep];
                statusText.textContent = step.text;
                progressBar.style.width = step.progress + '%';
                
                // Update metrics randomly during optimization
                if (currentStep > 2 && currentStep < steps.length - 1) {
                    updateMetrics();
                }
                
                // Show experiment if this step reveals one
                if (step.showExperiment !== undefined && experiments[step.showExperiment]) {
                    showExperiment(experiments[step.showExperiment]);
                }
                
                // Regenerate pattern visualization occasionally
                if (currentStep % 3 === 0) {
                    patternViz.innerHTML = generatePatternBars();
                }
                
                currentStep++;
                setTimeout(animateStep, 600);
            } else {
                // Show final metrics
                showFinalMetrics();
                // Redirect after a brief pause
                setTimeout(() => {
                    document.getElementById('intro-container').classList.add('fade-out');
                    setTimeout(() => {
                        window.location.href = 'main.html';
                    }, 500);
                }, 1500);
            }
        }
        
        function updateMetrics() {
            const patterns = Math.floor(Math.random() * 50) + 100;
            const score = (Math.random() * 0.3 + 0.7).toFixed(3);
            const winRate = (Math.random() * 20 + 60).toFixed(1);
            
            document.getElementById('patterns-found').textContent = patterns;
            document.getElementById('optimization-score').textContent = score;
            document.getElementById('win-rate').textContent = winRate + '%';
        }
        
        function showFinalMetrics() {
            // Calculate totals from actual experiments
            const totalPatterns = experiments.length * 30; // Approximate
            const avgScore = experiments.reduce((sum, exp) => sum + exp.score, 0) / experiments.length;
            const avgWinRate = experiments.reduce((sum, exp) => sum + exp.winRate, 0) / experiments.length;
            
            document.getElementById('patterns-found').textContent = totalPatterns;
            document.getElementById('optimization-score').textContent = avgScore.toFixed(3);
            document.getElementById('win-rate').textContent = avgWinRate.toFixed(1) + '%';
            metricsContainer.classList.add('highlight-final');
        }
        
        function showExperiment(experiment) {
            experimentsDiscovered.style.display = 'block';
            
            const expDiv = document.createElement('div');
            expDiv.className = 'experiment-item';
            expDiv.innerHTML = `
                <div class="experiment-rank">#${experiment.rank}</div>
                <div class="experiment-details">
                    <div class="experiment-ticker">${experiment.ticker}</div>
                    <div class="experiment-name">${experiment.name}</div>
                </div>
                <div class="experiment-metrics">
                    <span class="experiment-score">Score: ${experiment.score.toFixed(2)}</span>
                    <span class="experiment-winrate">Win: ${experiment.winRate.toFixed(1)}%</span>
                </div>
            `;
            
            // Add stagger delay based on how many experiments are already shown
            const existingExperiments = experimentList.querySelectorAll('.experiment-item').length;
            expDiv.style.animationDelay = `${existingExperiments * 0.1}s`;
            
            experimentList.appendChild(expDiv);
        }
        
        // Start animation
        setTimeout(animateStep, 500);
    };
    </script>
</head>
<body class="intro-body">
    <div id="intro-container" class="intro-container">
        <div class="intro-header">
            <h1 class="intro-title">OptiFlag</h1>
            <p class="intro-subtitle">Advanced Trading Pattern Recognition System</p>
        </div>
        
        <div class="optimization-container">
            <div class="optimization-header">
                <h2>Running Bayesian Optimization</h2>
                <div class="ticker-badge">TSLA</div>
            </div>
            
            <div class="pattern-visualization" id="pattern-viz"></div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
                <p id="status-text" class="status-text">Initializing...</p>
            </div>
            
            <div id="metrics-container" class="metrics-grid intro-metrics">
                <div class="metric-box">
                    <span class="metric-label">Patterns Found</span>
                    <span id="patterns-found" class="metric-value">0</span>
                </div>
                <div class="metric-box">
                    <span class="metric-label">Optimization Score</span>
                    <span id="optimization-score" class="metric-value">0.000</span>
                </div>
                <div class="metric-box">
                    <span class="metric-label">Win Rate</span>
                    <span id="win-rate" class="metric-value">0.0%</span>
                </div>
            </div>
            
            <div id="experiments-discovered" class="experiments-discovered">
                <h3>Top Experiments Discovered</h3>
                <div id="experiment-list" class="experiment-list"></div>
            </div>
            
            <div class="discovery-note">
                <p>Discovering optimal trading parameters through Bayesian optimization...</p>
            </div>
        </div>
    </div>
</body>
</html>